<?xml version="1.0" encoding="UTF-8"?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see http://www.gnu.org/licenses/
-->

<xwikidoc version="1.1">
  <web>MatchingNotification</web>
  <name>PatientMatchNotificationEmailTemplate</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <creator>xwiki:XWiki.Admin</creator>
  <creationDate>1459795227000</creationDate>
  <parent>PhenoTips.WebHome</parent>
  <author>xwiki:XWiki.Admin</author>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <date>1459898008000</date>
  <contentUpdateDate>1459897988000</contentUpdateDate>
  <version>1.1</version>
  <title/>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>false</hidden>
  <content/>
  <object>
    <name>MatchingNotification.PatientMatchNotificationEmailTemplate</name>
    <number>0</number>
    <className>XWiki.Mail</className>
    <guid>bfa66698-2404-4fdc-84cf-394b41f602a8</guid>
    <class>
      <name>XWiki.Mail</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <html>
        <disabled>0</disabled>
        <name>html</name>
        <number>4</number>
        <prettyName>HTML</prettyName>
        <rows>15</rows>
        <size>80</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </html>
      <language>
        <disabled>0</disabled>
        <name>language</name>
        <number>2</number>
        <prettyName>Language</prettyName>
        <size>5</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </language>
      <subject>
        <disabled>0</disabled>
        <name>subject</name>
        <number>1</number>
        <prettyName>Subject</prettyName>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </subject>
      <text>
        <disabled>0</disabled>
        <name>text</name>
        <number>3</number>
        <prettyName>Text</prettyName>
        <rows>15</rows>
        <size>80</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </text>
    </class>
    <property>
      <html>#set($table = 'border: 1px solid black; border-collapse: collapse; text-align: left; vertical-align: top; font-weight: normal; padding: 0.2em;')
#set($subheader = 'font-weight : bold;')
#set($grey-background = 'background-color : lightgrey; width : 300px;')
#set($space-between-matches = 'margin-top : 25px;')
#set($disclaimer = 'font-size : 10px;')
#set($patient-id = 'white-space : no-wrap;')
#if ("$!subjectPatient.serverId" == "")
  #set($subjectPatientObj = $services.patients.get($!subjectPatient.patientId))
#end
&lt;p&gt;$!services.localization.render('phenotips.matchingNotifications.email.salutation', 'xhtml/1.0')&lt;/p&gt;
&lt;p&gt;$!services.localization.render('phenotips.matchingNotifications.email.introduction', 'xhtml/1.0', [$matches.size()])&lt;/p&gt;
#foreach ($match in $matches)
&lt;table  style="$table"&gt;
   &lt;thead&gt;
      &lt;tr&gt;
         &lt;th&gt;&lt;/th&gt;
         &lt;th style="$grey-background $table"&gt;
            &lt;div style="$subheader"&gt;$!services.localization.render('phenotips.matchingNotifications.email.table.yourPatient.label', 'xhtml/1.0')&lt;/div&gt;
            &lt;div style="$patient-id"&gt;
               &lt;span&gt;#if($subjectPatientObj)&lt;a href="$xwiki.getDocument($subjectPatientObj.document).getExternalURL()" target="_blank"&gt;$!{escapetool.xml($!subjectPatient.patientId)}&lt;/a&gt;#else$!{escapetool.xml($!subjectPatient.patientId)}#end&lt;/span&gt;
               &lt;span&gt;$!{escapetool.xml($!subjectPatient.externalId)}&lt;/span&gt;
            &lt;/div&gt;
         &lt;/th&gt;
         &lt;th style="$grey-background $table"&gt;
            &lt;div style="$subheader"&gt;$!services.localization.render('phenotips.matchingNotifications.email.table.matchPatient.label', 'xhtml/1.0')&lt;/div&gt;
            &lt;div&gt;
               &lt;span&gt;$!{escapetool.xml($!match.matchedPatient.patientId)}&lt;/span&gt;
               &lt;span&gt;$!{escapetool.xml($!match.matchedPatient.serverId)}&lt;/span&gt;
            &lt;/div&gt;
         &lt;/th&gt;
      &lt;/tr&gt;
   &lt;/thead&gt;
   &lt;tbody&gt;
      &lt;tr style="$table"&gt;
         &lt;td style="$table"&gt;&lt;div style="$subheader"&gt;$!services.localization.render('phenotips.matchingNotifications.email.table.modeOfInheritance.label', 'xhtml/1.0')&lt;/div&gt;&lt;/td&gt;
         &lt;td style="$table"&gt;
#foreach ($item in $!subjectPatient.modeOfInheritance)
&lt;div&gt;$!{escapetool.xml($item)}&lt;div&gt;
#end
         &lt;/td&gt;
         &lt;td style="$table"&gt;
#foreach ($item in $!match.matchedPatient.modeOfInheritance)
&lt;div&gt;$!{escapetool.xml($!item)}&lt;div&gt;
#end
         &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr style="$table"&gt;
         &lt;td style="$table"&gt;&lt;div style="$subheader"&gt;$!services.localization.render('phenotips.matchingNotifications.email.table.ageOfOnset.label', 'xhtml/1.0')&lt;/div&gt;&lt;/td&gt;
         &lt;td style="$table"&gt;$!{escapetool.xml($!subjectPatient.ageOfOnset)}&lt;/td&gt;
         &lt;td style="$table"&gt;$!{escapetool.xml($!match.matchedPatient.ageOfOnset)}&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr style="$table"&gt;
         &lt;td style="$table"&gt;&lt;div style="$subheader"&gt;$!services.localization.render('phenotips.matchingNotifications.email.table.genes.label', 'xhtml/1.0')&lt;/div&gt;&lt;/td&gt;
         &lt;td style="$table"&gt;
#foreach ($gene in $subjectPatient.candidateGenes)
&lt;div&gt;$!{escapetool.xml($!gene)}&lt;/div&gt;
#end
         &lt;/td&gt;
         &lt;td style="$table"&gt;
#foreach ($gene in $match.matchedPatient.candidateGenes)
&lt;div&gt;$!{escapetool.xml($!gene)}&lt;/div&gt;
#end
         &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr style="$table"&gt;
         &lt;td style="$table"&gt;&lt;div style="$subheader"&gt;$!services.localization.render('phenotips.matchingNotifications.email.table.phenotypes.label', 'xhtml/1.0')&lt;/div&gt;&lt;/td&gt;
         &lt;td style="$table"&gt;
#set ($firstUncommonPhenotype = false)
#foreach ($phenotype in $subjectPatient.phenotypes.predefined)
  #if (!$firstUncommonPhenotype &amp;&amp; $match.matchedPatient.phenotypes.predefined.size() &gt;= $foreach.index)
    #if ($!match.matchedPatient.phenotypes.predefined[$foreach.index].name != $!phenotype.name)
      #set ($firstUncommonPhenotype = $!match.matchedPatient.phenotypes.predefined[$foreach.index].name)
      &lt;div style="border: 1px solid black;"&gt;&lt;/div&gt;
    #end
  #end
&lt;div&gt;
#if ($phenotype.observed == 'no')
$!services.localization.render('phenotips.matchingNotifications.email.table.phenotypes.negativePhenotype', 'xhtml/1.0', [$!phenotype.name])
#else
$!{escapetool.xml($phenotype.name)}
#end
&lt;/div&gt;
#end
#foreach ($phenotype in $subjectPatient.phenotypes.freeText)
&lt;div&gt;
#if ($phenotype.observed == 'no')
$!services.localization.render('phenotips.matchingNotifications.email.table.phenotypes.negativePhenotype', 'xhtml/1.0', [$!phenotype.name])
#else
$!{escapetool.xml($!phenotype.name)}
#end
&lt;/div&gt;
#end
         &lt;/td&gt;
         &lt;td style="$table"&gt;
#foreach ($phenotype in $match.matchedPatient.phenotypes.predefined)
#if ($firstUncommonPhenotype &amp;&amp; $!phenotype.name == $firstUncommonPhenotype)&lt;div style="border: 1px solid black;"&gt;&lt;/div&gt;#end
&lt;div&gt;
#if ($phenotype.observed == 'no')
$!services.localization.render('phenotips.matchingNotifications.email.table.phenotypes.negativePhenotype', 'xhtml/1.0', [$!phenotype.name])
#else
$!{escapetool.xml($!phenotype.name)}
#end
&lt;/div&gt;
#end
#foreach ($phenotype in $match.matchedPatient.phenotypes.freeText)
&lt;div&gt;
#if ($phenotype.observed == 'no')
$!services.localization.render('phenotips.matchingNotifications.email.table.phenotypes.negativePhenotype', 'xhtml/1.0', [$!phenotype.name])
#else
$!{escapetool.xml($!phenotype.name)}
#end
&lt;/div&gt;
#end
         &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr style="$table"&gt;
         &lt;td colspan="3"&gt;
            &lt;div style="$subheader"&gt;$!services.localization.render('phenotips.matchingNotifications.email.table.contact.label', 'xhtml/1.0')&lt;/div&gt;
#foreach ($email in $match.matchedPatient.emails)
&lt;div&gt;$!{escapetool.xml($!email)}&lt;/div&gt;
#end
&lt;div&gt;$!services.localization.render('phenotips.matchingNotifications.email.table.contact.instructions', 'xhtml/1.0')&lt;/div&gt;
         &lt;/td&gt;
      &lt;/tr&gt;
   &lt;tbody&gt;
&lt;/table&gt;
&lt;div style="$space-between-matches"/&gt;
#end
&lt;p&gt;$!services.localization.render('phenotips.matchingNotifications.email.conclusion', 'xhtml/1.0')&lt;/p&gt;
&lt;p&gt;$!services.localization.render('phenotips.matchingNotifications.email.closing', 'xhtml/1.0')&lt;br /&gt;
$!services.localization.render('phenotips.matchingNotifications.email.signature', 'xhtml/1.0')&lt;/p&gt;
&lt;p style="$disclaimer"&gt;$!services.localization.render('phenotips.matchingNotifications.email.disclaimer', 'xhtml/1.0')&lt;/p&gt;</html>
    </property>
    <property>
      <language>English</language>
    </property>
    <property>
      <subject>$services.localization.render('phenotips.matchingNotifications.email.subject', [$!subjectPatient.patientId])</subject>
    </property>
    <property>
      <text>$services.localization.render('phenotips.matchingNotifications.email.salutation')

$services.localization.render('phenotips.matchingNotifications.email.introduction', [$matches.size()])

$services.localization.render('phenotips.matchingNotifications.email.table.yourPatient.label'): $!subjectPatient.patientId $!subjectPatient.externalId
$services.localization.render('phenotips.matchingNotifications.email.table.modeOfInheritance.label'):
#foreach ($item in $!subjectPatient.modeOfInheritance)
* $!item
#end
$services.localization.render('phenotips.matchingNotifications.email.table.ageOfOnset.label'): $!subjectPatient.ageOfOnset
$services.localization.render('phenotips.matchingNotifications.email.table.genes.label'):
#foreach ($gene in $!subjectPatient.candidateGenes)
* $!gene
#end
$services.localization.render('phenotips.matchingNotifications.email.table.phenotypes.label'):
#foreach ($!phenotype in $!subjectPatient.phenotypes.predefined)
#if ($!phenotype.observed == 'no')
* $services.localization.render('phenotips.matchingNotifications.email.table.phenotypes.negativePhenotype', [$!phenotype.name])
#else
* $!phenotype.name
#end
#end
#foreach ($!phenotype in $subjectPatient.phenotypes.freeText)
#if ($!phenotype.observed == 'no')
* $services.localization.render('phenotips.matchingNotifications.email.table.phenotypes.negativePhenotype', [$!phenotype.name])
#else
* $!phenotype.name
#end
#end

#foreach ($match in $matches)
$services.localization.render('phenotips.matchingNotifications.email.table.matchPatient.label'): $match.matchedPatient.patientId $!match.matchedPatient.serverId
$services.localization.render('phenotips.matchingNotifications.email.table.modeOfInheritance.label'):
#foreach ($item in $match.matchedPatient.modeOfInheritance)
* $!item
#end
$services.localization.render('phenotips.matchingNotifications.email.table.ageOfOnset.label'): $!match.matchedPatient.ageOfOnset
$services.localization.render('phenotips.matchingNotifications.email.table.genes.label'):
#foreach ($gene in $match.matchedPatient.candidateGenes)
* $!gene
#end
$services.localization.render('phenotips.matchingNotifications.email.table.phenotypes.label'):
#foreach ($!phenotype in $match.matchedPatient.phenotypes.predefined)
#if ($!phenotype.observed == 'no')
* $services.localization.render('phenotips.matchingNotifications.email.table.phenotypes.negativePhenotype', [$!phenotype.name])
#else
* $!phenotype.name
#end
#end
#foreach ($!phenotype in $match.matchedPatient.phenotypes.freeText)
#if ($!phenotype.observed == 'no')
* $services.localization.render('phenotips.matchingNotifications.email.table.phenotypes.negativePhenotype', [$!phenotype.name])
#else
* $!phenotype.name
#end
#end
$services.localization.render('phenotips.matchingNotifications.email.table.contact.label'):
#foreach ($email in $match.matchedPatient.emails)
* $!email
#end

$services.localization.render('phenotips.matchingNotifications.email.table.contact.instructions')

#end
$services.localization.render('phenotips.matchingNotifications.email.conclusion')

$services.localization.render('phenotips.matchingNotifications.email.closing')
$services.localization.render('phenotips.matchingNotifications.email.signature')

$services.localization.render('phenotips.matchingNotifications.email.disclaimer')</text>
    </property>
  </object>
</xwikidoc>
